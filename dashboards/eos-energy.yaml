###############################################################################
# EOS Energy Optimizer â€” Lovelace Dashboard
#
# Requirements:
#   - HACS custom card: apexcharts-card (https://github.com/RomRider/apexcharts-card)
#
# Usage:
#   1. Install apexcharts-card via HACS â†’ Frontend
#   2. In HA go to Settings â†’ Dashboards â†’ + Add Dashboard â†’ choose "from YAML"
#      or paste this into a manual dashboard's raw config editor
#   3. Adjust entity IDs if your integration entry has a different device name
#
# All entity IDs below assume the default device name "EOS Energy Optimizer"
# which HA slugifies to the prefix sensor.eos_energy_optimizer_
###############################################################################

title: EOS Energy Optimizer
views:
  - title: Ãœbersicht
    path: eos
    cards:
      # â”€â”€ Status â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: entities
        title: "âš¡ EOS Status"
        entities:
          - entity: sensor.eos_energy_optimizer_optimization_status
            name: Optimierung
          - entity: sensor.eos_energy_optimizer_current_mode
            name: Aktueller Modus
          - entity: sensor.eos_energy_optimizer_energy_plan
            name: Energieplan
          - entity: binary_sensor.eos_energy_optimizer_discharge_allowed
            name: Entladung erlaubt
          - entity: sensor.eos_energy_optimizer_override_status
            name: Override
          - entity: sensor.eos_energy_optimizer_total_cost
            name: Gesamtkosten

      # â”€â”€ SG-Ready â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: entities
        title: "ğŸ”¥ SG-Ready WÃ¤rmepumpe"
        entities:
          - entity: sensor.eos_energy_optimizer_sg_ready_mode
            name: SG-Ready Modus
          - entity: switch.eos_energy_optimizer_sg_ready_auto_control
            name: SG-Ready Automatik

      # â”€â”€ Battery Storage Price â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: entities
        title: "ğŸ”‹ Batterie-Speicherpreis"
        entities:
          - entity: sensor.eos_energy_optimizer_battery_storage_price
            name: Speicherpreis
          - entity: button.eos_energy_optimizer_reset_battery_price
            name: Speicherpreis zurÃ¼cksetzen

      # â”€â”€ PV Prognose (48 h) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: custom:apexcharts-card
        header:
          title: "â˜€ï¸ PV Prognose (48 h)"
          show: true
        graph_span: 48h
        span:
          start: hour
        series:
          - entity: sensor.eos_energy_optimizer_pv_forecast
            name: PV
            type: area
            color: "#FFD600"
            stroke_width: 2
            opacity: 0.25
            data_generator: |
              return entity.attributes.forecast.map((val, idx) => {
                const d = new Date();
                d.setMinutes(0, 0, 0);
                d.setHours(d.getHours() + idx);
                return [d.getTime(), val];
              });
        yaxis:
          - id: power
            min: 0
            apex_config:
              title:
                text: "W"

      # â”€â”€ Strompreis (48 h) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: custom:apexcharts-card
        header:
          title: "ğŸ’¶ Strompreis (48 h)"
          show: true
        graph_span: 48h
        span:
          start: hour
        series:
          - entity: sensor.eos_energy_optimizer_price_forecast
            name: Preis
            type: line
            color: "#E53935"
            stroke_width: 2
            curve: stepline
            data_generator: |
              return entity.attributes.forecast.map((val, idx) => {
                const d = new Date();
                d.setMinutes(0, 0, 0);
                d.setHours(d.getHours() + idx);
                return [d.getTime(), val * 100];
              });
        yaxis:
          - id: price
            apex_config:
              title:
                text: "ct/kWh"

      # â”€â”€ Batterie SOC (48 h) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: custom:apexcharts-card
        header:
          title: "ğŸ”‹ Batterie SOC (48 h)"
          show: true
        graph_span: 48h
        span:
          start: hour
        series:
          - entity: sensor.eos_energy_optimizer_battery_soc_forecast
            name: SOC
            type: area
            color: "#1E88E5"
            stroke_width: 2
            opacity: 0.3
            data_generator: |
              return entity.attributes.forecast.map((val, idx) => {
                const d = new Date();
                d.setMinutes(0, 0, 0);
                d.setHours(d.getHours() + idx);
                return [d.getTime(), val];
              });
        yaxis:
          - id: soc
            min: 0
            max: 100
            apex_config:
              title:
                text: "%"

      # â”€â”€ Lade-/Entlade-Plan (48 h) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: custom:apexcharts-card
        header:
          title: "âš™ï¸ Lade-/Entlade-Plan (48 h)"
          show: true
        graph_span: 48h
        span:
          start: hour
        series:
          - entity: sensor.eos_energy_optimizer_ac_charge_power
            name: AC Charge
            type: column
            color: "#43A047"
            opacity: 0.7
            data_generator: |
              return entity.attributes.forecast.map((val, idx) => {
                const d = new Date();
                d.setMinutes(0, 0, 0);
                d.setHours(d.getHours() + idx);
                return [d.getTime(), val];
              });
          - entity: sensor.eos_energy_optimizer_dc_charge_power
            name: DC Charge
            type: column
            color: "#66BB6A"
            opacity: 0.7
            data_generator: |
              return entity.attributes.forecast.map((val, idx) => {
                const d = new Date();
                d.setMinutes(0, 0, 0);
                d.setHours(d.getHours() + idx);
                return [d.getTime(), val];
              });
        apex_config:
          chart:
            stacked: true
        yaxis:
          - id: power
            apex_config:
              title:
                text: "W"

      # â”€â”€ Verbrauch (48 h) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: custom:apexcharts-card
        header:
          title: "ğŸ  Verbrauch (48 h)"
          show: true
        graph_span: 48h
        span:
          start: hour
        series:
          - entity: sensor.eos_energy_optimizer_consumption_forecast
            name: Verbrauch
            type: area
            color: "#8E24AA"
            stroke_width: 2
            opacity: 0.25
            data_generator: |
              return entity.attributes.forecast.map((val, idx) => {
                const d = new Date();
                d.setMinutes(0, 0, 0);
                d.setHours(d.getHours() + idx);
                return [d.getTime(), val];
              });
        yaxis:
          - id: power
            min: 0
            apex_config:
              title:
                text: "W"

      # â”€â”€ Batterie-Parameter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: entities
        title: "ğŸ”§ Batterie-Parameter"
        entities:
          - entity: number.eos_energy_optimizer_battery_capacity
            name: KapazitÃ¤t (kWh)
          - entity: number.eos_energy_optimizer_max_charge_power
            name: Max. Ladeleistung (W)
          - entity: number.eos_energy_optimizer_inverter_power
            name: Wechselrichterleistung (W)
          - entity: number.eos_energy_optimizer_minimum_soc
            name: Min. SOC (%)
          - entity: number.eos_energy_optimizer_maximum_soc
            name: Max. SOC (%)

      # â”€â”€ Konfiguration â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - type: entities
        title: "âš™ï¸ Konfiguration"
        entities:
          - entity: sensor.eos_energy_optimizer_optimization_status
            name: EOS Server
            type: attribute
            attribute: eos_server_url
          - entity: sensor.eos_energy_optimizer_resource_status
            name: Ressourcenstatus
          - entity: sensor.eos_energy_optimizer_ev_charge_plan
            name: E-Auto Ladeplan
          - entity: sensor.eos_energy_optimizer_appliance_schedule
            name: GerÃ¤te-Zeitplan

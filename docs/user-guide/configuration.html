<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuration Reference - EOS HA</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
</head>
<body>
    <!-- DRAFT BANNER - REMOVE WHEN FINALIZED -->
    <div class="draft-banner">
        <i class="fas fa-exclamation-triangle"></i> DRAFT DOCUMENTATION - UNDER REVIEW <i class="fas fa-exclamation-triangle"></i>
    </div>
    <!-- END DRAFT BANNER -->

    <!-- Navigation -->
    <nav class="nav-header">
        <div class="nav-container">
            <a href="../index.html" class="nav-logo">
                <img src="../assets/images/icon.png" alt="EOS HA" style="height: 48px; vertical-align: middle; margin-right: 8px;">
                <span>EOS HA</span>
                <span class="version-badge">v0.2.30</span>
            </a>
            <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" aria-label="Toggle menu">
                <i class="fas fa-bars"></i>
            </button>
            <ul class="nav-menu">
                <li><a href="../index.html">Home</a></li>
                <li><a href="../what-is/index.html">What Is</a></li>
                <li><a href="index.html">User Guide</a></li>
                <li><a href="configuration.html" class="active">Configuration</a></li>
                <li><a href="../advanced/index.html">Advanced</a></li>
                <li><a href="../developer/index.html">Developer</a></li>
                <li><a href="https://github.com/rockinglama/eos-ha" target="_blank"><i class="fab fa-github"></i> GitHub</a></li>
                <li><a href="https://github.com/sponsors/rockinglama" target="_blank" title="Sponsor the project"><i class="fas fa-mug-hot"></i></a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="page-wrapper">
            <aside class="toc-sidebar">
                <h3>On This Page</h3>
                <nav class="toc-nav">
                    <a href="#load" class="toc-link">Load</a>
                    <a href="#eos" class="toc-link">EOS Server</a>
                    <a href="#price" class="toc-link">Electricity Prices</a>
                    <a href="#battery" class="toc-link">Battery</a>
                    <a href="#pv" class="toc-link">PV Forecasts</a>
                    <a href="#inverter" class="toc-link">Inverter</a>
                    <a href="#evcc" class="toc-link">EVCC</a>
                    <a href="#mqtt" class="toc-link">MQTT</a>
                    <a href="#other" class="toc-link">Other Settings</a>
                    <a href="#examples" class="toc-link">Config Examples</a>
                    <a href="#example-full" class="toc-link toc-sub">→ Full Config</a>
                    <a href="#example-minimal" class="toc-link toc-sub">→ Minimal Config</a>
                    <a href="#example-evcc" class="toc-link toc-sub">→ EVCC Setup</a>
                    <a href="#example-solcast" class="toc-link toc-sub">→ Solcast Setup</a>
                </nav>
            </aside>

            <main class="main-content">
        <div class="hero">
            <h1>Configuration Reference</h1>
            <p>Complete guide to all config.yaml parameters with explanations and practical examples</p>
        </div>

        <!-- Table of Contents -->
        <div class="content-section">
            <h2><i class="fas fa-list"></i> Quick Navigation</h2>
            <div class="feature-grid">
                <div class="feature-item">
                    <a href="#load"><i class="fas fa-plug"></i> Load Configuration</a>
                </div>
                <div class="feature-item">
                    <a href="#eos"><i class="fas fa-server"></i> EOS Server</a>
                </div>
                <div class="feature-item">
                    <a href="#price"><i class="fas fa-dollar-sign"></i> Electricity Prices</a>
                </div>
                <div class="feature-item">
                    <a href="#battery"><i class="fas fa-battery-full"></i> Battery</a>
                </div>
                <div class="feature-item">
                    <a href="#pv"><i class="fas fa-sun"></i> PV Forecasts</a>
                </div>
                <div class="feature-item">
                    <a href="#inverter"><i class="fas fa-solar-panel"></i> Inverter</a>
                </div>
                <div class="feature-item">
                    <a href="#evcc"><i class="fas fa-car"></i> EVCC</a>
                </div>
                <div class="feature-item">
                    <a href="#mqtt"><i class="fas fa-network-wired"></i> MQTT</a>
                </div>
                <div class="feature-item">
                    <a href="#other"><i class="fas fa-cog"></i> Other Settings</a>
                </div>
                <div class="feature-item">
                    <a href="#examples"><i class="fas fa-file-code"></i> Config Examples</a>
                </div>
            </div>
        </div>

        <!-- Load Configuration -->
        <div class="content-section" id="load">
            <h2><i class="fas fa-plug"></i> Load Configuration</h2>
            <p>Configure how EOS HA reads your household power consumption data.</p>

            <h3>load.source</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>load.source</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Data source for load power consumption</td>
                </tr>
                <tr>
                    <th>Valid Values</th>
                    <td><code>homeassistant</code>, <code>openhab</code>, <code>default</code></td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>default</code> (uses static consumption profile)</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>source: homeassistant</code></td>
                </tr>
            </table>

            <h3>load.url</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>load.url</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>URL to your Home Assistant or OpenHAB instance</td>
                </tr>
                <tr>
                    <th>Valid Values</th>
                    <td><code>http://&lt;hostname_or_ip&gt;:&lt;port&gt;</code></td>
                </tr>
                <tr>
                    <th>Examples</th>
                    <td>
                        <code>http://homeassistant:8123</code><br>
                        <code>http://192.168.1.100:8080</code>
                    </td>
                </tr>
            </table>

            <h3>load.access_token</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>load.access_token</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Long-lived access token for Home Assistant</td>
                </tr>
                <tr>
                    <th>Required</th>
                    <td>Yes for Home Assistant, optional for OpenHAB</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...</code></td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>In Home Assistant: Profile → Long-Lived Access Tokens → Create Token<br>Leave empty if not needed: <code>access_token:</code></td>
                </tr>
            </table>

            <h3>load.load_sensor</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>load.load_sensor</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Entity/item name for total household power consumption</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Watts (W)</td>
                </tr>
                <tr>
                    <th>Examples</th>
                    <td>
                        <code>sensor.house_power</code> (Home Assistant)<br>
                        <code>PowerMeter_Load</code> (OpenHAB)
                    </td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Represents overall net household load (total house consumption). Positive (consumption) or negative (feed-in) values are converted to absolute positive internally.</td>
                </tr>
            </table>

            <h3>load.car_charge_load_sensor</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>load.car_charge_load_sensor</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Entity/item for EV charger power consumption (optional)</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Watts (W)</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>sensor.wallbox_power</code></td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Separates controllable EV charging from base household load for more accurate optimization. This load is <strong>subtracted</strong> from the main load sensor value. Leave empty if not needed: <code>car_charge_load_sensor:</code></td>
                </tr>
            </table>

            <h3>load.additional_load_1_sensor</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>load.additional_load_1_sensor</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Entity/item for additional controllable load (e.g., heat pump, dishwasher)</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Watts (W)</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>sensor.heatpump_power</code></td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Separates additional controllable devices from base household load. This load is <strong>subtracted</strong> from the main load sensor value. Leave empty if not needed: <code>additional_load_1_sensor:</code></td>
                </tr>
            </table>

            <h3>load.additional_load_1_runtime</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>load.additional_load_1_runtime</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Expected runtime of additional load</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Minutes</td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>0</code> (not used)</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>120</code> (2 hours)</td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Helps optimization engine plan when to run the additional load</td>
                </tr>
            </table>

            <h3>load.additional_load_1_consumption</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>load.additional_load_1_consumption</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Energy consumption of additional load for ONE hour</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Watt-hours (Wh)</td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>0</code> (not used)</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>2000</code> (2 kWh per hour)</td>
                </tr>
            </table>
        </div>

        <!-- EOS Server Configuration -->
        <div class="content-section" id="eos">
            <h2><i class="fas fa-server"></i> EOS Server Configuration</h2>
            <p>Configure the connection to your external optimization backend (Akkudoktor EOS or EVopt).</p>

            <h3>eos.source</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>eos.source</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Which optimization backend to use</td>
                </tr>
                <tr>
                    <th>Valid Values</th>
                    <td><code>eos_server</code>, <code>evopt</code></td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>eos_server</code></td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>
                        <strong>eos_server</strong>: Full-featured Akkudoktor EOS (<a href="https://github.com/Akkudoktor-EOS/EOS" target="_blank">GitHub</a>)<br>
                        <strong>evopt</strong>: Lightweight, faster alternative (<a href="https://github.com/thecem/hassio-evopt" target="_blank">GitHub</a>)
                    </td>
                </tr>
            </table>

            <h3>eos.server</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>eos.server</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Hostname or IP address of your EOS/EVopt server</td>
                </tr>
                <tr>
                    <th>Required</th>
                    <td>Yes</td>
                </tr>
                <tr>
                    <th>Examples</th>
                    <td>
                        <code>homeassistant</code><br>
                        <code>192.168.1.50</code><br>
                        <code>eos.local</code>
                    </td>
                </tr>
            </table>

            <h3>eos.port</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>eos.port</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Port number of your optimization server</td>
                </tr>
                <tr>
                    <th>Valid Values</th>
                    <td>
                        <code>8503</code> for eos_server<br>
                        <code>7050</code> for evopt
                    </td>
                </tr>
                <tr>
                    <th>Required</th>
                    <td>Yes</td>
                </tr>
            </table>

            <h3>eos.time_frame</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>eos.time_frame</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Granularity of optimization time steps</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Seconds</td>
                </tr>
                <tr>
                    <th>Valid Values</th>
                    <td>
                        <code>3600</code> - Hourly optimization (EOS server only option; EVopt also supports this)<br>
                        <code>900</code> - 15-minute optimization (EVopt only; will be auto-corrected to 3600 if used with EOS server)
                    </td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>3600</code></td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Smaller values = more detailed optimization but higher computational load</td>
                </tr>
            </table>

            <h3>eos.timeout</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>eos.timeout</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Maximum time to wait for optimization response</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Seconds</td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>180</code></td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>120-180</code> for normal operation</td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Increase if optimization takes longer or server is slow</td>
                </tr>
            </table>
        </div>

        <!-- Price Configuration -->
        <div class="content-section" id="price">
            <h2><i class="fas fa-dollar-sign"></i> Electricity Price Configuration</h2>
            <p>Configure dynamic electricity pricing for cost optimization.</p>
            
            <div class="alert alert-warning">
                <strong><i class="fas fa-exclamation-triangle"></i> Important:</strong> All price values must use the same base - either all prices include taxes and fees, or all prices exclude taxes and fees. Mixing different bases will lead to incorrect optimization results.
            </div>

            <h3>price.source</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>price.source</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Provider for dynamic electricity prices</td>
                </tr>
                <tr>
                    <th>Valid Values</th>
                    <td>
                        <code>tibber</code> - Tibber API<br>
                        <code>smartenergy_at</code> - Austrian provider<br>
                        <code>stromligning</code> - Danish provider<br>
                        <code>fixed_24h</code> - Custom 24-hour array<br>
                        <code>default</code> - Akkudoktor API
                    </td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>default</code></td>
                </tr>
            </table>

            <h3>price.token</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>price.token</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>API token or configuration string for price provider</td>
                </tr>
                <tr>
                    <th>Valid Values</th>
                    <td>
                        <strong>Tibber:</strong> Your API token from <a href="https://developer.tibber.com" target="_blank">developer.tibber.com</a><br>
                        <strong>Strømligning:</strong> <code>supplierId/productId[/customerGroupId]</code>
                    </td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>radius_c/velkommen_gron_el/c</code> (Strømligning)</td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Leave empty if not needed: <code>token:</code></td>
                </tr>
            </table>

            <h3>price.fixed_price_adder_ct</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>price.fixed_price_adder_ct</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Fixed cost addition per kWh (e.g., grid fees, taxes)</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Cents per kWh (ct/kWh)</td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>0</code></td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>8.5</code> (adds 8.5 ct/kWh)</td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Only use with <code>source: default</code> (Akkudoktor) to add fixed costs to base prices. <strong>Not applied to other price sources.</strong></td>
                </tr>
            </table>

            <h3>price.relative_price_multiplier</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>price.relative_price_multiplier</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Percentage markup applied to (base price + fixed_price_adder_ct)</td>
                </tr>
                <tr>
                    <th>Valid Values</th>
                    <td>Decimal (e.g., <code>0.05</code> for 5%)</td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>0</code></td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>0.19</code> (adds 19% VAT)</td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Only use with <code>source: default</code> (Akkudoktor) for percentage-based fees. <strong>Not applied to other price sources.</strong></td>
                </tr>
            </table>

            <h3>price.fixed_24h_array</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>price.fixed_24h_array</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>24-hour array of fixed prices for each hour of the day</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Cents per kWh (ct/kWh)</td>
                </tr>
                <tr>
                    <th>Valid Values</th>
                    <td>Comma-separated list of 24 values (no brackets)<br>
                        Hour 0 (00:00-01:00), Hour 1 (01:00-02:00), ..., Hour 23 (23:00-24:00)
                    </td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td style="word-break: break-all;">
                        <code>10.5,10.5,10.5,10.5,10.5,23.0,<br>
                        28.2,28.2,28.2,28.2,28.2,23.5,<br>
                        23.5,23.5,23.5,28.2,28.2,34.3,<br>
                        34.3,34.3,34.3,34.3,28.0,23.0</code>
                    </td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Only use when <code>source: fixed_24h</code></td>
                </tr>
            </table>

            <h3>price.feed_in_price</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>price.feed_in_price</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Compensation you receive for feeding energy back to the grid</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Euro per kWh (€/kWh)</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>0.08</code> (8 cents per kWh)</td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Must use the same tax/fee basis as your purchase prices. Typical range: 0.05 - 0.12 €/kWh</td>
                </tr>
            </table>

            <h3>price.negative_price_switch</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>price.negative_price_switch</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>How to handle negative electricity market prices</td>
                </tr>
                <tr>
                    <th>Valid Values</th>
                    <td>
                        <code>true</code> - Limit feed-in price to €0 when market price is negative<br>
                        <code>false</code> - Always use the configured feed_in_price
                    </td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>false</code></td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Use <code>true</code> if your feed-in tariff pays €0 during negative market prices</td>
                </tr>
            </table>
        </div>

        <!-- Continue with Battery, PV, Inverter, EVCC, MQTT, Other sections... -->
        <!-- Due to length, I'll create a placeholder for now -->

        <div class="content-section" id="battery">
            <h2><i class="fas fa-battery-full"></i> Battery Configuration</h2>
            <p>Configure your battery system for state-of-charge monitoring and optimization.</p>

            <div class="alert alert-info">
                <strong><i class="fas fa-wand-magic-sparkles"></i> Automatic Sensor Conventions:</strong> EOS HA <strong>auto-detects</strong> both battery and grid sensor polarity (charging/discharging and import/export). No manual overrides required.
            </div>

            <h3>battery.source</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>battery.source</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Data source for battery SOC (State of Charge)</td>
                </tr>
                <tr>
                    <th>Valid Values</th>
                    <td>
                        <code>openhab</code> - OpenHAB integration<br>
                        <code>homeassistant</code> - Home Assistant integration<br>
                        <code>default</code> - Static data
                    </td>
                </tr>
            </table>

            <h3>battery.url</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>battery.url</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>URL for OpenHAB or Home Assistant server</td>
                </tr>
                <tr>
                    <th>Examples</th>
                    <td>
                        <code>http://192.168.1.50:8080</code> (OpenHAB)<br>
                        <code>http://homeassistant:8123</code> (Home Assistant)
                    </td>
                </tr>
            </table>

            <h3>battery.soc_sensor</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>battery.soc_sensor</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Item/entity name for the SOC sensor</td>
                </tr>
                <tr>
                    <th>Valid Values</th>
                    <td>
                        OpenHAB: Decimal (0-1), percentage (0-100), or UoM ('0 %' - '100 %')<br>
                        Home Assistant: Entity ID (e.g., <code>sensor.battery_soc</code>)
                    </td>
                </tr>
            </table>

            <h3>battery.access_token</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>battery.access_token</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Access token for Home Assistant authentication</td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Required for Home Assistant. Independent from load configuration token. Leave empty if not needed: <code>access_token:</code></td>
                </tr>
            </table>

            <h3>battery.capacity_wh</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>battery.capacity_wh</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Total capacity of the battery</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Watt-hours (Wh)</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>11059</code> (11.059 kWh)</td>
                </tr>
            </table>

            <h3>battery.charge_efficiency</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>battery.charge_efficiency</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Efficiency of charging the battery</td>
                </tr>
                <tr>
                    <th>Valid Values</th>
                    <td>Decimal between 0 and 1</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>0.88</code> (88% efficient)</td>
                </tr>
            </table>

            <h3>battery.discharge_efficiency</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>battery.discharge_efficiency</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Efficiency of discharging the battery</td>
                </tr>
                <tr>
                    <th>Valid Values</th>
                    <td>Decimal between 0 and 1</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>0.88</code> (88% efficient)</td>
                </tr>
            </table>

            <h3>battery.max_charge_power_w</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>battery.max_charge_power_w</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Maximum charging power for the battery</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Watts (W)</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>5000</code></td>
                </tr>
            </table>

            <h3>battery.min_soc_percentage</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>battery.min_soc_percentage</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Minimum state of charge for the battery</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Percentage (%)</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>5</code></td>
                </tr>
            </table>

            <h3>battery.max_soc_percentage</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>battery.max_soc_percentage</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Maximum state of charge for the battery</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Percentage (%)</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>100</code></td>
                </tr>
            </table>

            <h3>battery.charging_curve_enabled</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>battery.charging_curve_enabled</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Enable dynamic charging curve for battery protection</td>
                </tr>
                <tr>
                    <th>Valid Values</th>
                    <td>
                        <code>true</code> - Enable dynamic curve (SOC + temperature based)<br>
                        <code>false</code> - Always charge at max power
                    </td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>true</code></td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>
                        <strong>SOC-based reduction:</strong> At SOC ≤50%, full power. Above 50%, exponentially reduced to ~5% at 95% SOC.<br><br>
                        <strong>Temperature protection:</strong> If <code>sensor_battery_temperature</code> configured:<br>
                        <table style="margin-top: 10px; font-size: 0.9em;">
                            <tr style="background: rgba(255,255,255,0.05);">
                                <th style="width: 150px;">Temperature Range</th>
                                <th style="width: 120px;">Power Limit</th>
                                <th>Protection Reason</th>
                            </tr>
                            <tr>
                                <td>Below 0°C</td>
                                <td>5-7.5%</td>
                                <td>Prevents lithium plating in LiFePO4 batteries</td>
                            </tr>
                            <tr>
                                <td>0-5°C</td>
                                <td>5-15%</td>
                                <td>Gradual warm-up phase</td>
                            </tr>
                            <tr>
                                <td>5-15°C</td>
                                <td>15-100%</td>
                                <td>Transition to optimal operating range</td>
                            </tr>
                            <tr>
                                <td>15-45°C</td>
                                <td>100%</td>
                                <td>Optimal range (only SOC-based reduction applies)</td>
                            </tr>
                            <tr>
                                <td>45-50°C</td>
                                <td>100-45%</td>
                                <td>Heat warning - gradual reduction</td>
                            </tr>
                            <tr>
                                <td>50-60°C</td>
                                <td>45-7.5%</td>
                                <td>Severe heat protection</td>
                            </tr>
                            <tr>
                                <td>Above 60°C</td>
                                <td>5-7.5%</td>
                                <td>Critical temperature protection</td>
                            </tr>
                        </table>
                        <br><strong>Combined Effect:</strong> The final charging power is the product of both SOC and temperature multipliers.<br>
                        <em>Example: At -2°C with 51% SOC, charging power would be ~0.65 kW instead of 10 kW maximum.</em>
                    </td>
                </tr>
            </table>

            <h3>battery.sensor_battery_temperature</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>battery.sensor_battery_temperature</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Sensor/item identifier for battery temperature</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Celsius (°C)</td>
                </tr>
                <tr>
                    <th>Valid Values</th>
                    <td>Temperature range: -30°C to 70°C</td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>""</code> (disabled)</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>sensor.byd_battery_box_premium_hv_temperatur</code> (BYD Battery Box)</td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Highly recommended for battery protection. Enables automatic temperature-based charging power reduction. Values outside the -30°C to 70°C range are <strong>ignored for safety</strong>. If not configured or sensor fails, temperature protection is disabled and only SOC-based curve is used.</td>
                </tr>
            </table>

            <h3>battery.price_euro_per_wh_accu</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>battery.price_euro_per_wh_accu</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Static price for battery energy storage</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Euro per Wh (€/Wh)</td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>0</code></td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Can be used to shift optimization results based on available energy</td>
                </tr>
            </table>

            <h3>Battery Price Calculation Sensors</h3>
            <p>To enable dynamic price calculation, configure these sensors in your <code>config.yaml</code>:</p>
            <table>
                <tr>
                    <th>Sensor</th>
                    <th>Description</th>
                    <th>Example</th>
                </tr>
                <tr>
                    <td><code>battery_power_sensor</code></td>
                    <td>Battery charge/discharge power (W)</td>
                    <td><code>sensor.battery_power</code></td>
                </tr>
                <tr>
                    <td><code>pv_power_sensor</code></td>
                    <td>Total PV generation (W)</td>
                    <td><code>sensor.total_pv_power</code></td>
                </tr>
                <tr>
                    <td><code>grid_power_sensor</code></td>
                    <td>Grid import/export (W)</td>
                    <td><code>sensor.grid_power</code></td>
                </tr>
                <tr>
                    <td><code>load_power_sensor</code></td>
                    <td>Household consumption (W)</td>
                    <td><code>sensor.household_load</code></td>
                </tr>
                <tr>
                    <td><code>price_sensor</code></td>
                    <td>Current electricity price</td>
                    <td><code>sensor.electricity_price</code></td>
                </tr>
            </table>

            <div class="alert alert-success">
                <strong><i class="fas fa-check-circle"></i> Tip:</strong> EOS HA automatically <em>normalizes</em> battery and grid signs so charging attribution to PV vs Grid is correct — even if your grid sensor reports import as negative.
            </div>

            <div class="alert alert-warning">
                <strong><i class="fas fa-exclamation-triangle"></i> Troubleshooting:</strong> If battery charging appears attributed to PV while PV≈0 at night, check application logs for:
                <br><code>[BATTERY-PRICE] Detected conventions: battery=... grid=...</code>
                <br>and diagnostic lines mentioning <code>PV≈0 but PV attribution occurred</code>. This indicates sensor misalignment previously — now automatically corrected.
            </div>

            <h3>battery.price_euro_per_wh_sensor</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>battery.price_euro_per_wh_sensor</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Sensor/item that exposes battery price dynamically</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Euro per Wh (€/Wh)</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>sensor.battery_price</code> (Home Assistant)</td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>If configured, overrides static <code>price_euro_per_wh_accu</code> value. Leave empty to use static price.</td>
                </tr>
            </table>

            <div class="alert alert-info">
                <h4><i class="fas fa-calculator"></i> Dynamic Battery Price Calculation</h4>
                <p>EOS HA can automatically calculate the real cost of energy in your battery by analyzing historical charging events using a Last-In, First-Out (LIFO) inventory model.</p>
                
                <h5>How it Works:</h5>
                <ol>
                    <li><strong>Event Detection:</strong> The system scans historical data (default 96h) to identify "charging events" where battery power was above the <code>charging_threshold_w</code>.</li>
                    <li><strong>Source Attribution:</strong> For each event, it compares battery power with PV production and grid import. If grid import is significant (above <code>grid_charge_threshold_w</code>), energy is attributed to grid charging at the market price. PV surplus energy is attributed to solar charging at zero cost (since PV generation has no per-kWh cost).</li>
                    <li><strong>Inventory Valuation (LIFO):</strong> Instead of a simple average, the system uses a <strong>Last-In, First-Out</strong> model. It looks at the most recent charging sessions that match your current battery level. This ensures the price reflects the actual "value" of the energy currently inside the battery.</li>
                    <li><strong>Optimizer Integration:</strong> The resulting price is used by the optimizer to decide when it's profitable to discharge the battery.</li>
                    <li><strong>Efficiency:</strong> To minimize API load, the system uses a two-step fetching strategy: it first fetches low-resolution data to find events, then high-resolution data only for specific periods when the battery was actually charging.</li>
                </ol>
            </div>

            <h3>battery.price_calculation_enabled</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>battery.price_calculation_enabled</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Enable dynamic battery price calculation from historical data</td>
                </tr>
                <tr>
                    <th>Valid Values</th>
                    <td>
                        <code>true</code> - Analyze charging history to determine real energy cost<br>
                        <code>false</code> - Use static price or sensor value
                    </td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>false</code></td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>
                        Uses LIFO (Last-In, First-Out) inventory model. Analyzes charging events to determine if energy came from PV surplus (free) or grid (at market price). Represents the cost to replace the energy currently stored in the battery.
                    </td>
                </tr>
            </table>

            <h3>battery.price_update_interval</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>battery.price_update_interval</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Interval between dynamic price recalculations</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Seconds</td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>900</code> (15 minutes)</td>
                </tr>
            </table>

            <h3>battery.price_history_lookback_hours</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>battery.price_history_lookback_hours</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Number of hours to analyze for price calculation</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Hours</td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>96</code></td>
                </tr>
            </table>

            <h3>battery.battery_power_sensor</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>battery.battery_power_sensor</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Sensor for battery power (required for dynamic price calculation)</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Watts (W) - positive values must represent charging</td>
                </tr>
            </table>

            <h3>battery.pv_power_sensor</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>battery.pv_power_sensor</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Sensor for total PV power (required for dynamic price calculation)</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Watts (W)</td>
                </tr>
            </table>

            <h3>battery.grid_power_sensor</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>battery.grid_power_sensor</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Sensor for grid power (required for dynamic price calculation)</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Watts (W) - positive values represent import from grid</td>
                </tr>
            </table>

            <h3>battery.load_power_sensor</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>battery.load_power_sensor</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Sensor for household load power (required for dynamic price calculation)</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Watts (W)</td>
                </tr>
            </table>

            <h3>battery.price_sensor</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>battery.price_sensor</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Sensor for current electricity price (required for dynamic price calculation)</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Euro per kWh (€/kWh) or cents per kWh (ct/kWh)</td>
                </tr>
            </table>

            <h3>battery.charging_threshold_w</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>battery.charging_threshold_w</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Minimum battery power to consider as "charging" during analysis</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Watts (W)</td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>50.0</code></td>
                </tr>
            </table>

            <h3>battery.grid_charge_threshold_w</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>battery.grid_charge_threshold_w</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Minimum grid import power to attribute charging to grid vs PV surplus</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Watts (W)</td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>100.0</code></td>
                </tr>
            </table>
        </div>

        <div class="content-section" id="pv">
            <h2><i class="fas fa-sun"></i> PV Forecast Configuration</h2>
            <p>Configure solar generation forecasts from various providers.</p>

            <div class="alert alert-info">
                <strong><i class="fas fa-info-circle"></i> Note:</strong> Temperature forecasts (outside temperature from Akkudoktor) are <b>only retrieved and sent to the optimizer when <code>eos.source</code> is set to <code>eos_server</code></b>. For <code>evopt</code>, temperature is not used in optimization. <code>lat</code> and <code>lon</code> remain mandatory for PV forecast accuracy.
            </div>

            <h3>pv_forecast_source.source</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>pv_forecast_source.source</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Provider for solar generation forecasts</td>
                </tr>
                <tr>
                    <th>Valid Values</th>
                    <td>
                        <code>akkudoktor</code> - Akkudoktor API<br>
                        <code>openmeteo</code> - Open-Meteo<br>
                        <code>openmeteo_local</code> - Open-Meteo with local shading<br>
                        <code>forecast_solar</code> - Forecast.Solar<br>
                        <code>evcc</code> - EVCC integration<br>
                        <code>solcast</code> - Solcast<br>
                        <code>default</code> - Uses akkudoktor
                    </td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>akkudoktor</code></td>
                </tr>
            </table>

            <h3>pv_forecast_source.api_key</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>pv_forecast_source.api_key</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>API key for Solcast</td>
                </tr>
                <tr>
                    <th>Required</th>
                    <td>Yes, when source is <code>solcast</code></td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Obtain from <a href="https://solcast.com/" target="_blank">solcast.com</a>. Leave empty for other sources: <code>api_key:</code></td>
                </tr>
            </table>

            <div class="alert alert-warning">
                <strong><i class="fas fa-exclamation-triangle"></i> Solcast Rate Limits:</strong> Free accounts are limited to 10 API calls per day. EOS HA automatically extends update intervals to 2.5 hours when using Solcast (9.6 calls/day).
            </div>

            <h4>PV Installation Parameters</h4>
            <p>Configure one or more PV installations in the <code>pv_forecast</code> array:</p>

            <h3>pv_forecast[].name</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>name</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>User-defined identifier for the PV installation</td>
                </tr>
                <tr>
                    <th>Required</th>
                    <td>Yes (all sources)</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>Garden</code>, <code>Main Roof South</code></td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Must be unique if using multiple installations</td>
                </tr>
            </table>

            <h3>pv_forecast[].lat</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>lat</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Latitude of PV installation</td>
                </tr>
                <tr>
                    <th>Required</th>
                    <td>Yes (all sources - needed for temperature forecasts)</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>52.5200</code></td>
                </tr>
            </table>

            <h3>pv_forecast[].lon</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>lon</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Longitude of PV installation</td>
                </tr>
                <tr>
                    <th>Required</th>
                    <td>Yes (all sources - needed for temperature forecasts)</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>13.4050</code></td>
                </tr>
            </table>

            <h3>pv_forecast[].azimuth</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>azimuth</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Azimuth angle (0=North, 90=East, 180=South, 270=West)</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Degrees</td>
                </tr>
                <tr>
                    <th>Required</th>
                    <td>Yes (all sources except <code>solcast</code>, <code>evcc</code>)</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>180</code> (South-facing)</td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>For <code>evcc</code>/<code>solcast</code>, configured in their platforms, set to <code>180</code> in HA addon</td>
                </tr>
            </table>

            <h3>pv_forecast[].tilt</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>tilt</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Tilt angle (0=horizontal, 90=vertical)</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Degrees</td>
                </tr>
                <tr>
                    <th>Required</th>
                    <td>Yes (all sources except <code>solcast</code>, <code>evcc</code>)</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>30</code></td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>For <code>evcc</code>/<code>solcast</code>, configured in their platforms, set to <code>25</code> in HA addon</td>
                </tr>
            </table>

            <h3>pv_forecast[].power</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>power</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>PV installation power (peak Wp)</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Watts (W)</td>
                </tr>
                <tr>
                    <th>Required</th>
                    <td>Yes (all sources except <code>evcc</code>, <code>solcast</code>)</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>4600</code></td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>For <code>evcc</code>/<code>solcast</code>, still needed for system scaling, set to <code>1000</code> in HA addon</td>
                </tr>
            </table>

            <h3>pv_forecast[].powerInverter</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>powerInverter</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Inverter power capacity</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Watts (W)</td>
                </tr>
                <tr>
                    <th>Required</th>
                    <td>Yes (all sources except <code>evcc</code>, <code>forecast_solar</code>, <code>solcast</code>)</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>5000</code></td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Set to <code>1000</code> in HA addon if not needed</td>
                </tr>
            </table>

            <h3>pv_forecast[].inverterEfficiency</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>inverterEfficiency</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Inverter efficiency</td>
                </tr>
                <tr>
                    <th>Valid Values</th>
                    <td>Decimal between 0 and 1</td>
                </tr>
                <tr>
                    <th>Required</th>
                    <td>Yes (all sources except <code>evcc</code>, <code>forecast_solar</code>, <code>solcast</code>)</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>0.95</code> (95% efficient)</td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>For <code>evcc</code>/<code>forecast_solar</code>/<code>solcast</code>, set to <code>1</code> in HA addon</td>
                </tr>
            </table>

            <h3>pv_forecast[].horizon</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>horizon</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Shading situation for PV installation</td>
                </tr>
                <tr>
                    <th>Valid Values</th>
                    <td>Comma-separated values or list describing horizon elevation</td>
                </tr>
                <tr>
                    <th>Required</th>
                    <td>Yes (for <code>openmeteo_local</code>, <code>forecast_solar</code>)</td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>[0]*36</code> for openmeteo_local, <code>[0]*24</code> for forecast_solar</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>0,0,0,0,0,0,0,0,50,70,0,0,0,0,0,0,0,0</code></td>
                </tr>
            </table>

            <h3>pv_forecast[].resource_id</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>resource_id</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Solcast rooftop site identifier</td>
                </tr>
                <tr>
                    <th>Required</th>
                    <td>Yes (when source is <code>solcast</code>)</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>abcd-efgh-1234-5678</code></td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Obtained from Solcast dashboard after configuring rooftop site</td>
                </tr>
            </table>
        </div>

        <div class="content-section" id="inverter">
            <h2><i class="fas fa-solar-panel"></i> Inverter Configuration</h2>
            <p>Configure inverter control for automated battery management.</p>

            <h3>inverter.type</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>inverter.type</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Type of inverter for automated control</td>
                </tr>
                <tr>
                    <th>Valid Values</th>
                    <td>
                        <code>fronius_gen24</code> - Fronius Gen24 (enhanced V2 interface, firmware-based auth)<br>
                        <code>fronius_gen24_legacy</code> - Fronius Gen24 (legacy V1 interface)<br>
                        <code>evcc</code> - Universal via EVCC external battery control<br>
                        <code>default</code> - Disable control (display only)
                    </td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>default</code></td>
                </tr>
            </table>

            <h3>inverter.address</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>inverter.address</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>IP address of the inverter</td>
                </tr>
                <tr>
                    <th>Required</th>
                    <td>Yes (for <code>fronius_gen24</code>, <code>fronius_gen24_legacy</code>)</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>192.168.1.12</code></td>
                </tr>
            </table>

            <h3>inverter.user</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>inverter.user</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Username for inverter's local portal</td>
                </tr>
                <tr>
                    <th>Required</th>
                    <td>Yes (for <code>fronius_gen24</code>, <code>fronius_gen24_legacy</code>)</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>customer</code></td>
                </tr>
            </table>

            <h3>inverter.password</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>inverter.password</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Password for inverter's local portal</td>
                </tr>
                <tr>
                    <th>Required</th>
                    <td>Yes (for <code>fronius_gen24</code>, <code>fronius_gen24_legacy</code>)</td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>
                        <strong>Fronius Gen24 enhanced interface:</strong> Automatically detects firmware version and uses appropriate auth method. If you updated firmware to 1.38.6-1+ or newer, you may need to reset password in WebUI (http://your-inverter-ip/) under Settings → User Management.
                    </td>
                </tr>
            </table>

            <h3>inverter.max_grid_charge_rate</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>inverter.max_grid_charge_rate</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Maximum grid charge rate</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Watts (W)</td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>5000</code></td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Limitation for calculating target grid charge power and for EOS inverter model. Currently not supported by EVCC external battery control, but shown and calculated (reachable per EOS HA API)</td>
                </tr>
            </table>

            <h3>inverter.max_pv_charge_rate</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>inverter.max_pv_charge_rate</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Maximum PV charge rate</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Watts (W)</td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>5000</code></td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Limitation for calculating target PV charge power and for EOS inverter model. Currently not supported by EVCC external battery control, but shown and calculated (reachable per EOS HA API)</td>
                </tr>
            </table>
        </div>

        <div class="content-section" id="evcc">
            <h2><i class="fas fa-car"></i> EVCC Configuration</h2>
            <p>Configure integration with EVCC for EV charging management and PV forecast retrieval.</p>

            <h3>evcc.url</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>evcc.url</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>URL for the EVCC instance</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>http://192.168.1.100:7070</code></td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>
                        Leave empty if not used: <code>url:</code> or <code>url: ""</code><br><br>
                        <strong>Important:</strong> When using <code>evcc</code> as the <code>pv_forecast_source</code>, this EVCC configuration must be properly configured. EOS HA will retrieve PV forecasts directly from the EVCC API instead of using individual PV installation configurations. In this case, the <code>pv_forecast</code> section requires at least one entry with valid <code>lat</code> and <code>lon</code> coordinates for temperature forecasts.
                    </td>
                </tr>
            </table>

            <div class="alert alert-info">
                <strong><i class="fas fa-info-circle"></i> EVCC as Inverter Controller:</strong> When <code>inverter.type</code> is set to <code>evcc</code>, EOS HA uses EVCC's external battery control feature to manage battery charging. This provides a universal interface that works with many inverter types supported by EVCC.
            </div>
        </div>

        <div class="content-section" id="mqtt">
            <h2><i class="fas fa-network-wired"></i> MQTT Configuration</h2>
            <p>Configure MQTT broker connection and Home Assistant Auto Discovery.</p>

            <h3>mqtt.enabled</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>mqtt.enabled</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Enable or disable MQTT functionality</td>
                </tr>
                <tr>
                    <th>Valid Values</th>
                    <td>
                        <code>true</code> - Enable MQTT<br>
                        <code>false</code> - Disable MQTT
                    </td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>false</code></td>
                </tr>
            </table>

            <h3>mqtt.broker</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>mqtt.broker</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Address of the MQTT broker</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>localhost</code>, <code>192.168.1.10</code></td>
                </tr>
            </table>

            <h3>mqtt.port</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>mqtt.port</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Port of the MQTT broker</td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>1883</code></td>
                </tr>
            </table>

            <h3>mqtt.user</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>mqtt.user</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Username for MQTT broker authentication</td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>mqtt_user</code></td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Optional - leave empty if broker doesn't require authentication</td>
                </tr>
            </table>

            <h3>mqtt.password</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>mqtt.password</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Password for MQTT broker authentication</td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Optional - leave empty if broker doesn't require authentication</td>
                </tr>
            </table>

            <h3>mqtt.tls</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>mqtt.tls</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Enable or disable TLS for secure MQTT connections</td>
                </tr>
                <tr>
                    <th>Valid Values</th>
                    <td>
                        <code>true</code> - Use TLS for secure connections<br>
                        <code>false</code> - Do not use TLS
                    </td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>false</code></td>
                </tr>
            </table>

            <h3>mqtt.ha_mqtt_auto_discovery</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>mqtt.ha_mqtt_auto_discovery</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Enable or disable Home Assistant MQTT Auto Discovery</td>
                </tr>
                <tr>
                    <th>Valid Values</th>
                    <td>
                        <code>true</code> - Enable Auto Discovery<br>
                        <code>false</code> - Disable Auto Discovery
                    </td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>true</code></td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>When enabled, EOS HA automatically publishes device and entity configurations to Home Assistant</td>
                </tr>
            </table>

            <h3>mqtt.ha_mqtt_auto_discovery_prefix</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>mqtt.ha_mqtt_auto_discovery_prefix</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Prefix for Home Assistant MQTT Auto Discovery topics</td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>homeassistant</code></td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Only change if you've customized Home Assistant's discovery prefix</td>
                </tr>
            </table>
        </div>

        <div class="content-section" id="other">
            <h2><i class="fas fa-cog"></i> Other Configuration Settings</h2>
            <p>General application settings and behavior.</p>

            <h3>refresh_time</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>refresh_time</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>How often EOS HA sends optimization requests to EOS server</td>
                </tr>
                <tr>
                    <th>Unit</th>
                    <td>Minutes</td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>3</code></td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>
                        Controls update frequency. Works together with <code>eos.time_frame</code>:<br>
                        • <code>refresh_time</code> = how often to request optimization<br>
                        • <code>time_frame</code> = granularity of each optimization (900s=15min, 3600s=hourly)
                    </td>
                </tr>
            </table>

            <h3>time_zone</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>time_zone</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Time zone for the application</td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>Europe/Berlin</code></td>
                </tr>
                <tr>
                    <th>Example</th>
                    <td><code>America/New_York</code>, <code>Asia/Tokyo</code></td>
                </tr>
            </table>

            <h3>eos_ha_web_port</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>eos_ha_web_port</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Port for EOS HA web server and API</td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>8081</code></td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Access web dashboard at <code>http://your-server:8081</code></td>
                </tr>
            </table>

            <h3>log_level</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>log_level</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>Logging verbosity level</td>
                </tr>
                <tr>
                    <th>Valid Values</th>
                    <td>
                        <code>debug</code> - Detailed debugging information<br>
                        <code>info</code> - General informational messages<br>
                        <code>warning</code> - Warning messages only<br>
                        <code>error</code> - Error messages only
                    </td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>info</code></td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Use <code>debug</code> for troubleshooting, <code>info</code> for normal operation</td>
                </tr>
            </table>

            <h3>request_timeout</h3>
            <table>
                <tr>
                    <th>Parameter</th>
                    <td><code>request_timeout</code></td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>HTTP request timeout for Home Assistant and OpenHAB API calls</td>
                </tr>
                <tr>
                    <th>Valid Values</th>
                    <td><code>5-120</code> (seconds)</td>
                </tr>
                <tr>
                    <th>Default</th>
                    <td><code>10</code></td>
                </tr>
                <tr>
                    <th>Notes</th>
                    <td>Increase this value if you experience frequent timeout errors when reading sensor data from Home Assistant or OpenHAB, especially when running on slower hardware (e.g., Synology NAS). Values outside the 5-120 range are automatically clamped to the valid range.</td>
                </tr>
            </table>

            <div class="alert alert-info">
                <strong><i class="fas fa-file-alt"></i> Configuration File:</strong> The <code>config.yaml</code> file must be located in the <code>src</code> directory. If it doesn't exist, EOS HA will create one with default values on first startup and prompt you to configure it before restarting.
            </div>

            <h3>Understanding refresh_time and time_frame</h3>
            <div class="alert alert-warning">
                <h4><i class="fas fa-clock"></i> Two Different Timing Controls</h4>
                <p>These two parameters control different aspects of optimization:</p>
                <ul>
                    <li><strong>refresh_time</strong>: Sets how often EOS HA sends a new optimization request to the EOS server (e.g., every 3 minutes)</li>
                    <li><strong>time_frame</strong> (in EOS section): Sets the granularity of the optimization and forecast arrays inside each request (e.g., 900 for 15-minute steps, 3600 for hourly steps)</li>
                </ul>
                <p><strong>Backend Capabilities:</strong></p>
                <ul>
                  <li><strong>EOS Server:</strong> Only supports <code>3600</code> (hourly) - 15-minute intervals are not supported</li>
                  <li><strong>EVopt:</strong> Supports both <code>3600</code> (hourly) and <code>900</code> (15-minute) for more precise optimization</li>
                </ul>
                <p>If you set <code>time_frame: 900</code> with <code>eos_server</code>, it will be automatically corrected to 3600 at startup with a warning.</p>
                <p>The combination of <code>refresh_time</code> and <code>time_frame</code> allows you to control both how frequently the system updates and how detailed the optimization is.</p>
            </div>
        </div>

        <!-- Configuration Examples Section -->
        <div class="content-section" id="examples">
            <h2><i class="fas fa-file-code"></i> Configuration Examples</h2>
            <p>Complete example configurations for different use cases.</p>

            <h3 id="example-full">Full Configuration Example</h3>
            <p>This complete example will be automatically generated at first startup. Copy and customize for your setup:</p>
            <pre><code class="yaml"># Load configuration
load:
  source: default  # Data source for load power - openhab, homeassistant, default (using a static load profile)
  url: http://homeassistant:8123 # URL for openhab or homeassistant (e.g. http://openhab:8080 or http://homeassistant:8123)
  access_token: abc123 # access token for homeassistant (optional)
  load_sensor: Load_Power # item / entity for load power data in watts
  car_charge_load_sensor: Wallbox_Power # item / entity for wallbox power data in watts. (If not needed, set to "")
  additional_load_1_sensor: "additional_load_1_sensor" # item / entity for additional load power. (If not needed set to "")
  additional_load_1_runtime: 2 # runtime for additional load 1 in minutes - default: 0 (If not needed set to "")
  additional_load_1_consumption: 1500 # consumption for additional load 1 in Wh - default: 0 (If not needed set to "")

# EOS server configuration
eos:
  source: eos_server  # EOS server source - eos_server, evopt, default (default uses eos_server)
  server: 192.168.1.94  # EOS server address
  port: 8503 # port for EOS server - default: 8503
  timeout: 180 # timeout for EOS optimize request in seconds - default: 180
  time_frame: 3600 # granularity of optimization steps in seconds (3600=hourly for EOS server; 900=15min for EVopt only)

# Electricity price configuration
price:
  source: default  # data source for electricity price tibber, smartenergy_at, stromligning, fixed_24h, default (default uses akkudoktor)
  token: tibberBearerToken # Token for electricity price (for Stromligning use supplierId/productId[/customerGroupId])
  fixed_price_adder_ct: 2.5 # Describes the fixed cost addition in ct per kWh.
  relative_price_multiplier: 0.05 # Applied to (base energy price + fixed_price_adder_ct). Use a decimal (e.g., 0.05 for 5%).
  fixed_24h_array: 10.41, 10.42, 10.42, 10.42, 10.42, 23.52, 28.17, 28.17, 28.17, 28.17, 28.17, 23.52, 23.52, 23.52, 23.52, 28.17, 28.17, 34.28, 34.28, 34.28, 34.28, 34.28, 28.17, 23.52 # 24 hours array with fixed prices over the day
  feed_in_price: 0.0 # feed in price for the grid in €/kWh
  negative_price_switch: false # switch for no payment if negative stock price is given

# battery configuration
battery:
  source: default  # Data source for battery soc - openhab, homeassistant, default
  url: http://homeassistant:8123 # URL for openhab or homeassistant (e.g. http://openhab:7070 or http://homeassistant:8123)
  soc_sensor: battery_SOC # item / entity for battery SOC data in [0..1]
  access_token: abc123 # access token for homeassistant (optional)
  capacity_wh: 11059 # battery capacity in Wh
  charge_efficiency: 0.88 # efficiency for charging the battery in [0..1]
  discharge_efficiency: 0.88 # efficiency for discharging the battery in [0..1]
  max_charge_power_w: 5000 # max charging power in W
  min_soc_percentage: 5 # min battery soc in %
  max_soc_percentage: 100 # max battery soc in %
  price_euro_per_wh_accu: 0 # price for battery in €/Wh
  price_euro_per_wh_sensor: "" # Home Assistant entity (e.g. sensor.battery_price) providing €/Wh
  charging_curve_enabled: true # enable dynamic charging curve for battery (SOC-based + temperature-based if sensor configured)
  sensor_battery_temperature: "" # sensor for battery temperature in °C (e.g., sensor.byd_battery_box_premium_hv_temperatur) - enables temperature protection

# List of PV forecast source configuration
pv_forecast_source:
  source: akkudoktor # data source for solar forecast providers akkudoktor, openmeteo, openmeteo_local, forecast_solar, evcc, solcast, default (default uses akkudoktor)
  api_key: "" # API key for Solcast (required only when source is 'solcast')

# List of PV forecast configurations. Add multiple entries as needed.
# See Akkudoktor API (https://api.akkudoktor.net/#/pv%20generation%20calculation/getForecast) for more details.
pv_forecast:
  - name: myPvInstallation1  # User-defined identifier for the PV installation, have to be unique if you use more installations
    lat: 52.5200 # Latitude for PV forecast
    lon: 13.4050 # Longitude for PV forecast
    azimuth: 90.0 # Azimuth for PV forecast
    tilt: 30.0 # Tilt for PV forecast
    power: 4600 # Power for PV forecast
    powerInverter: 5000 # Power Inverter for PV forecast
    inverterEfficiency: 0.9 # Inverter Efficiency for PV forecast
    horizon: 10,20,10,15 # Horizon to calculate shading up to 360 values to describe shading situation for your PV.
    resource_id: "" # Resource ID for Solcast (required only when source is 'solcast')

# Inverter configuration
inverter:
  type: default  # Type of inverter - fronius_gen24, fronius_gen24_legacy, evcc, default (default will disable inverter control - only displaying the target state) - preset: default
  address: 192.168.1.12 # Address of the inverter (fronius_gen24, fronius_gen24_legacy only)
  user: customer # Username for the inverter (fronius_gen24, fronius_gen24_legacy only)
  password: abc123 # Password for the inverter (fronius_gen24, fronius_gen24_legacy only)
  max_grid_charge_rate: 5000 # Max inverter grid charge rate in W - default: 5000
  max_pv_charge_rate: 5000 # Max inverter PV charge rate in W - default: 5000

# EVCC configuration
evcc:
  url: http://yourEVCCserver:7070  # URL to your evcc installation, if not used set to "" or leave as http://yourEVCCserver:7070

# MQTT configuration
mqtt:
  enabled: false # Enable MQTT - default: false
  broker: localhost # URL for MQTT server - default: mqtt://yourMQTTserver
  port: 1883 # Port for MQTT server - default: 1883
  user: mqtt_user # Username for MQTT server - default: mqtt
  password: mqtt_password # Password for MQTT server - default: mqtt
  tls: false # Use TLS for MQTT server - default: false
  ha_mqtt_auto_discovery: true # Enable Home Assistant MQTT auto discovery - default: true
  ha_mqtt_auto_discovery_prefix: homeassistant # Prefix for Home Assistant MQTT auto discovery - default: homeassistant

# General application settings
refresh_time: 3 # Default refresh time of EOS connect in minutes - default: 3
time_zone: Europe/Berlin # Default time zone - default: Europe/Berlin
eos_ha_web_port: 8081 # Default port for EOS connect server - default: 8081
log_level: info # Log level for the application : debug, info, warning, error - default: info
request_timeout: 10 # Request timeout for Home Assistant and OpenHAB API calls in seconds (5-120) - default: 10</code></pre>

            <h3 id="example-minimal">Minimal Configuration Example</h3>
            <p>Minimum required configuration for basic operation (copy and customize):</p>
            <div class="alert alert-info">
                <strong><i class="fas fa-info-circle"></i> Note:</strong> Within HA addon, unused parameters will be automatically added after saving. For standalone installations, use empty strings <code>""</code> for unused parameters.
            </div>
            <pre><code class="yaml"># Load configuration
load:
  source: default  # Data source for load power - openhab, homeassistant, default (using a static load profile)
  load_sensor: Load_Power # item / entity for load power data in watts
  car_charge_load_sensor: "" # item / entity for wallbox power data in watts. (If not needed, set to "")

# EOS server configuration
eos:
  source: eos_server  # EOS server source - eos_server, evopt, default (default uses eos_server)
  server: 192.168.1.94  # EOS server address
  port: 8503 # port for EOS server - default: 8503
  timeout: 180 # timeout for EOS optimize request in seconds - default: 180
  time_frame: 3600 # granularity of optimization steps in seconds (3600=hourly for EOS server; 900=15min for EVopt only)

# Electricity price configuration
price:
  source: default  # data source for electricity price tibber, smartenergy_at, stromligning, fixed_24h, default (default uses akkudoktor)
  token: "" # Provide Tibber token or Stromligning supplierId/productId[/customerGroupId] when needed
  fixed_price_adder_ct: 0 # Describes the fixed cost addition in ct per kWh.
  relative_price_multiplier: 0 # Applied to (base energy price + fixed_price_adder_ct). Use a decimal (e.g., 0.05 for 5%).

# battery configuration
battery:
  source: default  # Data source for battery soc - openhab, homeassistant, default
  capacity_wh: 11059 # battery capacity in Wh
  charge_efficiency: 0.88 # efficiency for charging the battery in [0..1]
  discharge_efficiency: 0.88 # efficiency for discharging the battery in [0..1]
  max_charge_power_w: 5000 # max charging power in W

# List of PV forecast source configuration
pv_forecast_source:
  source: akkudoktor # data source for solar forecast providers akkudoktor, openmeteo, openmeteo_local, forecast_solar, evcc, solcast, default (default uses akkudoktor)

# List of PV forecast configurations. Add multiple entries as needed.
# See Akkudoktor API (https://api.akkudoktor.net/#/pv%20generation%20calculation/getForecast) for more details.
pv_forecast:
  - name: myPvInstallation1  # User-defined identifier for the PV installation, have to be unique if you use more installations
    lat: 52.5200 # Latitude for PV forecast
    lon: 13.4050 # Longitude for PV forecast
    azimuth: 90.0 # Azimuth for PV forecast
    tilt: 30.0 # Tilt for PV forecast

# Inverter configuration
inverter:
  type: default  # Type of inverter - fronius_gen24, fronius_gen24_legacy, evcc, default (default will disable inverter control - only displaying the target state) - preset: default

# EVCC configuration
evcc:
  url: ""  # URL to your evcc installation, if not used set to ""

# MQTT configuration
mqtt:
  enabled: false # Enable MQTT - default: false

# General application settings
refresh_time: 3 # Default refresh time of EOS connect in minutes - default: 3
time_zone: Europe/Berlin # Default time zone - default: Europe/Berlin
eos_ha_web_port: 8081 # Default port for EOS connect server - default: 8081
log_level: info # Log level for the application : debug, info, warning, error - default: info
request_timeout: 10 # Request timeout for Home Assistant and OpenHAB API calls in seconds (5-120) - default: 10</code></pre>

            <h3 id="example-evcc">Example: Using EVCC for PV Forecasts</h3>
            <p>When using EVCC as your PV forecast source, configuration is simplified as EVCC provides aggregated forecast data (copy and customize):</p>
            <pre><code class="yaml"># PV forecast source configuration - using EVCC
pv_forecast_source:
  source: evcc # Use EVCC for PV forecasts

pv_forecast:
  - name: "Location for Temperature" # At least one entry needed for temperature forecasts
    lat: 52.5200 # Required for temperature forecasts used by EOS optimization
    lon: 13.4050 # Required for temperature forecasts used by EOS optimization
    # Other parameters (azimuth, tilt, power, etc.) not used for PV forecasts but can be included

# EVCC configuration - REQUIRED when using evcc as pv_forecast_source
evcc:
  url: http://192.168.1.100:7070  # URL to your EVCC installation</code></pre>
            <div class="alert alert-info">
                <strong><i class="fas fa-info-circle"></i> Important:</strong>
                <ul>
                    <li>EVCC handles all PV installation details and provides aggregated forecasts</li>
                    <li>The <code>pv_forecast</code> section requires at least one entry with valid <code>lat</code> and <code>lon</code> coordinates for temperature forecasts</li>
                    <li>Temperature forecasts are essential for EOS optimization, regardless of PV forecast source - they are always retrieved from Akkudoktor</li>
                    <li>The <code>evcc.url</code> must point to a reachable EVCC instance with API access enabled</li>
                </ul>
            </div>

            <h3 id="example-solcast">Example: Using Solcast for PV Forecasts</h3>
            <p>When using Solcast, you need to configure rooftop sites in the Solcast dashboard first (copy and customize):</p>
            <pre><code class="yaml"># PV forecast source configuration - using Solcast
pv_forecast_source:
  source: solcast # Use Solcast for PV forecasts
  api_key: "your_solcast_api_key_here" # Your Solcast API key (required)

# PV forecast configurations using Solcast resource IDs
pv_forecast:
  - name: "Main Roof South"
    resource_id: "abcd-efgh-1234-5678" # Resource ID from Solcast dashboard
    lat: 52.5200 # Required for temperature forecasts used by EOS optimization
    lon: 13.4050 # Required for temperature forecasts used by EOS optimization
    power: 5000 # Still needed for system scaling
    powerInverter: 5000 # Still needed for system scaling
    inverterEfficiency: 0.95 # Still needed for system scaling
    # azimuth, tilt, horizon not used for PV forecasts - configured in Solcast dashboard
  - name: "Garage East"
    resource_id: "ijkl-mnop-9999-0000" # Different resource ID for second installation
    lat: 52.5200 # Same location coordinates can be used for multiple installations
    lon: 13.4050
    power: 2500
    powerInverter: 2500
    inverterEfficiency: 0.92</code></pre>

            <div class="alert alert-warning">
                <h4><i class="fas fa-exclamation-triangle"></i> Solcast Rate Limiting</h4>
                <ul>
                    <li>Each PV installation requires a separate rooftop site configured in your Solcast account</li>
                    <li>Physical PV parameters (tilt, azimuth) are configured in the Solcast dashboard, not in EOS HA</li>
                    <li><strong>Location coordinates (lat, lon) are still required</strong> for temperature forecasts that EOS uses for optimization calculations</li>
                    <li>The <code>resource_id</code> is obtained from your Solcast rooftop site configuration</li>
                    <li><code>power</code>, <code>powerInverter</code>, and <code>inverterEfficiency</code> are still required for proper system scaling</li>
                    <li><strong>Free Solcast accounts are limited to 10 API calls per day</strong></li>
                    <li><strong>EOS HA automatically extends update intervals to 2.5 hours when using Solcast</strong> to stay within the 10 calls/day limit (9.6 calls/day actual usage)</li>
                    <li>Multiple PV installations result in multiple API calls per update cycle - consider this when planning your configuration</li>
                    <li>If you exceed rate limits, EOS HA will use the previous forecast data until the next successful API call</li>
                </ul>
                <p><strong>Setting up Solcast:</strong></p>
                <ol>
                    <li>Create a free account at <a href="https://solcast.com" target="_blank">solcast.com</a></li>
                    <li>Configure a "Rooftop Site" with your PV system details (location, tilt, azimuth, capacity)</li>
                    <li>Copy the Resource ID from your rooftop site</li>
                    <li>Get your API key from the account settings</li>
                    <li>Use these values in your EOS HA configuration (including lat/lon for temperature forecasts)</li>
                </ol>
            </div>
        </div>
            </main>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>EOS HA Documentation | <a href="../index.html">Home</a> | <a href="https://github.com/rockinglama/eos-ha">GitHub</a> | <a href="https://github.com/sponsors/rockinglama">Sponsor</a></p>
    </footer>

    <!-- Scroll spy for TOC -->
    <script>
        const sections = document.querySelectorAll('.content-section[id]');
        const tocLinks = document.querySelectorAll('.toc-link');

        function highlightTOC() {
            let current = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                if (pageYOffset >= sectionTop - 100) {
                    current = section.getAttribute('id');
                }
            });

            tocLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) {
                    link.classList.add('active');
                }
            });
        }

        window.addEventListener('scroll', highlightTOC);
        highlightTOC();
    </script>

    <!-- Back to Top Button -->
    <button class="back-to-top" onclick="scrollToTop()" aria-label="Back to top">
        <i class="fas fa-chevron-up"></i>
    </button>

    <script>
function toggleMobileMenu() {
    const menu = document.querySelector('.nav-menu');
    menu.classList.toggle('mobile-active');
}

// Close mobile menu when clicking outside
document.addEventListener('click', function(event) {
    const menu = document.querySelector('.nav-menu');
    const toggle = document.querySelector('.mobile-menu-toggle');
    if (menu.classList.contains('mobile-active') && !menu.contains(event.target) && !toggle.contains(event.target)) {
        menu.classList.remove('mobile-active');
    }
});
    </script>

    <script>
// Back to top button functionality
const backToTopButton = document.querySelector('.back-to-top');

window.addEventListener('scroll', function() {
    if (window.pageYOffset > 300) {
        backToTopButton.classList.add('visible');
    } else {
        backToTopButton.classList.remove('visible');
    }
});

function scrollToTop() {
    window.scrollTo({
        top: 0,
        behavior: 'smooth'
    });
}
    </script>
</body>
</html>
